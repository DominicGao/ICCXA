<!DOCTYPE html>
<html>
<head>
    <title>å†™å­—æ¥¼äºŒæ¬¡è£…ä¿®çœ‹æ¿ - æ•°æ®æ“ä½œç‰ˆ</title>
    <meta charset="UTF-8">
    <style>
        /* åŸºç¡€æ ·å¼ */
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1890ff;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #1890ff;
            padding-bottom: 10px;
        }
        
        /* æ“ä½œé¢æ¿ */
        .operation-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #1890ff;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #096dd9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(24, 144, 255, 0.4);
        }
        
        .btn-success {
            background-color: #52c41a;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #389e0d;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(82, 196, 26, 0.4);
        }
        
        .btn-warning {
            background-color: #faad14;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #d48806;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(250, 173, 20, 0.4);
        }
        
        .btn-danger {
            background-color: #ff4d4f;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #cf1322;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 77, 79, 0.4);
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .data-table th {
            background-color: #1890ff;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        
        .data-table td {
            padding: 10px;
            border-bottom: 1px solid #e8e8e8;
        }
        
        .data-table tr:hover {
            background-color: #f0f7ff;
        }
        
        .data-table tr.selected {
            background-color: #e6f7ff;
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-section {
            background-color: #fafafa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e8e8e8;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }
        
        /* çŠ¶æ€æ ‡è®° */
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            min-width: 80px;
        }
        
        .status-new { background-color: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
        .status-processing { background-color: #e6f7ff; color: #1890ff; border: 1px solid #91d5ff; }
        .status-delay { background-color: #fff1f0; color: #ff4d4f; border: 1px solid #ffa39e; }
        .status-completed { background-color: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
        .status-warning { background-color: #fff7e6; color: #fa8c16; border: 1px solid #ffd591; }
        
        /* æ ‡è®°æ“ä½œæŒ‰é’® */
        .mark-btn {
            padding: 4px 10px;
            font-size: 12px;
            border-radius: 3px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            margin-right: 5px;
        }
        
        .mark-btn:hover {
            opacity: 0.8;
        }
        
        /* é€‰é¡¹å¡ */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e8e8e8;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            font-weight: bold;
            color: #666;
        }
        
        .tab.active {
            color: #1890ff;
            border-bottom-color: #1890ff;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* KPIå¡ç‰‡ */
        .kpi-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            text-align: center;
        }
        
        .kpi-value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
            color: #1890ff;
        }
        
        .kpi-title {
            color: #666;
            font-size: 14px;
        }
        
        .kpi-trend {
            font-size: 12px;
        }
        
        .trend-up { color: #52c41a; }
        .trend-down { color: #ff4d4f; }
        
        /* é¢„è­¦é¢æ¿ */
        .warning-panel {
            background: linear-gradient(135deg, #fff7e6 0%, #fff1f0 100%);
            border-left: 4px solid #fa8c16;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            min-width: 500px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #1890ff;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: #1890ff;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .close-btn:hover {
            color: #ff4d4f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¢ å†™å­—æ¥¼äºŒæ¬¡è£…ä¿®æ™ºèƒ½çœ‹æ¿</h1>
        
        <!-- æ“ä½œé¢æ¿ -->
        <div class="operation-panel">
            <h3>ğŸ“‹ æ•°æ®æ“ä½œä¸­å¿ƒ</h3>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="showAddForm()">â• æ–°å¢é¡¹ç›®</button>
                <button class="btn btn-success" onclick="generateSampleData()">ğŸ² ç”Ÿæˆç¤ºä¾‹æ•°æ®</button>
                <button class="btn btn-warning" onclick="exportToExcel()">ğŸ“Š å¯¼å‡ºExcel</button>
                <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>
                <button class="btn btn-primary" onclick="showStatistics()">ğŸ“ˆ æŸ¥çœ‹ç»Ÿè®¡</button>
            </div>
        </div>
        
        <!-- é€‰é¡¹å¡ -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('dashboard')">ğŸ¯ é¢†å¯¼çœ‹æ¿</div>
            <div class="tab" onclick="switchTab('projects')">ğŸ“‹ é¡¹ç›®ç®¡ç†</div>
            <div class="tab" onclick="switchTab('inspection')">ğŸ” å·¡æ£€è®°å½•</div>
            <div class="tab" onclick="switchTab('analysis')">ğŸ“Š æ•°æ®åˆ†æ</div>
        </div>
        
        <!-- ä»ªè¡¨æ¿ -->
        <div id="dashboard" class="tab-content active">
            <div class="kpi-container">
                <div class="kpi-card">
                    <div class="kpi-title">æ´»è·ƒé¡¹ç›®æ•°</div>
                    <div class="kpi-value" id="kpiActive">0</div>
                    <div class="kpi-trend trend-up">è¾ƒä¸Šæœˆ +2</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">æ€»è£…ä¿®é¢ç§¯</div>
                    <div class="kpi-value" id="kpiArea">0ã¡</div>
                    <div class="kpi-trend trend-up">ç¯æ¯”å¢é•¿ 15%</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">æœ¬æœˆè¿è§„</div>
                    <div class="kpi-value" id="kpiViolation">0æ¬¡</div>
                    <div class="kpi-trend trend-down">å‡å°‘ 3æ¬¡</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">å·¡æ£€å®Œæˆç‡</div>
                    <div class="kpi-value" id="kpiInspection">0%</div>
                    <div class="kpi-trend trend-up">æé«˜ 5%</div>
                </div>
            </div>
            
            <!-- é¢„è­¦ä¿¡æ¯ -->
            <div class="warning-panel">
                <h4>âš ï¸ é£é™©é¢„è­¦</h4>
                <div id="warningList"></div>
            </div>
            
            <!-- é¡¹ç›®çŠ¶æ€åˆ†å¸ƒ -->
            <h3>ğŸ“Š é¡¹ç›®çŠ¶æ€åˆ†å¸ƒ</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>çŠ¶æ€</th>
                        <th>é¡¹ç›®æ•°é‡</th>
                        <th>å æ¯”</th>
                        <th>æ€»è£…ä¿®é¢ç§¯</th>
                        <th>å¹³å‡å·¥æœŸ</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="statusDistribution">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>
        
        <!-- é¡¹ç›®ç®¡ç† -->
        <div id="projects" class="tab-content">
            <div class="form-section">
                <h4>ğŸ” é¡¹ç›®ç­›é€‰</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div class="form-group">
                        <label class="form-label">çŠ¶æ€ç­›é€‰</label>
                        <select class="form-control" onchange="filterProjects()" id="filterStatus">
                            <option value="">å…¨éƒ¨çŠ¶æ€</option>
                            <option value="å®¡æ‰¹ä¸­">å®¡æ‰¹ä¸­</option>
                            <option value="æ–½å·¥ä¸­">æ–½å·¥ä¸­</option>
                            <option value="å¾…éªŒæ”¶">å¾…éªŒæ”¶</option>
                            <option value="å·²å®Œæˆ">å·²å®Œæˆ</option>
                            <option value="å·²é€¾æœŸ">å·²é€¾æœŸ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ¥¼å±‚ç­›é€‰</label>
                        <input type="text" class="form-control" oninput="filterProjects()" id="filterFloor" placeholder="è¾“å…¥æ¥¼å±‚">
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ–½å·¥æ–¹ç­›é€‰</label>
                        <input type="text" class="form-control" oninput="filterProjects()" id="filterContractor" placeholder="æ–½å·¥æ–¹åç§°">
                    </div>
                </div>
            </div>
            
            <h3>ğŸ“‹ é¡¹ç›®åˆ—è¡¨</h3>
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 80px;">é€‰æ‹©</th>
                            <th>é¡¹ç›®ID</th>
                            <th>ç§Ÿæˆ·åç§°</th>
                            <th>æ¥¼å±‚/å•å…ƒ</th>
                            <th>è£…ä¿®ç±»å‹</th>
                            <th>é¢ç§¯(ã¡)</th>
                            <th>åˆåŒå·¥æœŸ</th>
                            <th>å½“å‰çŠ¶æ€</th>
                            <th>æ–½å·¥æ–¹</th>
                            <th>è´Ÿè´£äºº</th>
                            <th>è¿›åº¦</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="projectList">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
            
            <div class="btn-group" style="margin-top: 20px;">
                <button class="btn btn-warning" onclick="batchUpdateStatus()">ğŸ“ æ‰¹é‡æ›´æ–°çŠ¶æ€</button>
                <button class="btn btn-danger" onclick="batchDelete()">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
                <button class="btn btn-primary" onclick="exportProjects()">ğŸ“¤ å¯¼å‡ºé¡¹ç›®è¡¨</button>
            </div>
        </div>
        
        <!-- å·¡æ£€è®°å½• -->
        <div id="inspection" class="tab-content">
            <div class="form-section">
                <h4>ğŸ“ æ–°å¢å·¡æ£€è®°å½•</h4>
                <form id="inspectionForm" onsubmit="return addInspectionRecord(event)">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div class="form-group">
                            <label class="form-label">é¡¹ç›®ID</label>
                            <select class="form-control" required id="inspectionProjectId">
                                <option value="">é€‰æ‹©é¡¹ç›®</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">å·¡æ£€æ—¥æœŸ</label>
                            <input type="date" class="form-control" required id="inspectionDate" value="">
                        </div>
                        <div class="form-group">
                            <label class="form-label">å·¡æ£€äºº</label>
                            <input type="text" class="form-control" required id="inspector" placeholder="å·¡æ£€äººå‘˜å§“å">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div class="form-group">
                            <label class="form-label">é—®é¢˜ç±»å‹</label>
                            <select class="form-control" required id="problemType">
                                <option value="">é€‰æ‹©ç±»å‹</option>
                                <option value="æ¶ˆé˜²è¿è§„">æ¶ˆé˜²è¿è§„</option>
                                <option value="å®‰å…¨è¿è§„">å®‰å…¨è¿è§„</option>
                                <option value="ç‰©æ–™å †æ”¾">ç‰©æ–™å †æ”¾</option>
                                <option value="å™ªéŸ³æ‰°æ°‘">å™ªéŸ³æ‰°æ°‘</option>
                                <option value="ç¯å¢ƒå«ç”Ÿ">ç¯å¢ƒå«ç”Ÿ</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ä¸¥é‡ç¨‹åº¦</label>
                            <select class="form-control" required id="severity">
                                <option value="ä½">ä½</option>
                                <option value="ä¸­">ä¸­</option>
                                <option value="é«˜">é«˜</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ•´æ”¹æœŸé™</label>
                            <input type="date" class="form-control" required id="rectifyDate">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">é—®é¢˜æè¿°</label>
                        <textarea class="form-control" rows="3" required id="problemDescription" placeholder="è¯¦ç»†æè¿°å‘ç°çš„é—®é¢˜..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-success">ğŸ’¾ ä¿å­˜å·¡æ£€è®°å½•</button>
                    <button type="button" class="btn btn-primary" onclick="generateRandomInspection()">ğŸ² ç”Ÿæˆéšæœºå·¡æ£€</button>
                </form>
            </div>
            
            <h3>ğŸ“… å·¡æ£€è®°å½•åˆ—è¡¨</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>æ—¥æœŸ</th>
                        <th>é¡¹ç›®ID</th>
                        <th>æ¥¼å±‚/å•å…ƒ</th>
                        <th>å·¡æ£€äºº</th>
                        <th>é—®é¢˜ç±»å‹</th>
                        <th>ä¸¥é‡ç¨‹åº¦</th>
                        <th>æ•´æ”¹æœŸé™</th>
                        <th>æ•´æ”¹çŠ¶æ€</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="inspectionList">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>
        
        <!-- æ•°æ®åˆ†æ -->
        <div id="analysis" class="tab-content">
            <div class="kpi-container">
                <div class="kpi-card">
                    <div class="kpi-title">é—®é¢˜ç±»å‹åˆ†å¸ƒ</div>
                    <canvas id="problemTypeChart" width="200" height="200"></canvas>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">è¿è§„è¶‹åŠ¿</div>
                    <canvas id="violationTrendChart" width="200" height="200"></canvas>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">æ–½å·¥æ–¹è¯„åˆ†</div>
                    <canvas id="contractorScoreChart" width="200" height="200"></canvas>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
                <div>
                    <h4>ğŸ“ˆ æœˆåº¦ç»Ÿè®¡</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æœˆä»½</th>
                                <th>å¼€å·¥æ•°</th>
                                <th>å®Œå·¥æ•°</th>
                                <th>è¿è§„æ•°</th>
                                <th>å·¡æ£€æ•°</th>
                                <th>æ•´æ”¹ç‡</th>
                            </tr>
                        </thead>
                        <tbody id="monthlyStats">
                            <!-- åŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
                
                <div>
                    <h4>ğŸ† æ–½å·¥æ–¹æ’å</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ’å</th>
                                <th>æ–½å·¥æ–¹</th>
                                <th>é¡¹ç›®æ•°</th>
                                <th>å¹³å‡å·¥æœŸ</th>
                                <th>è¿è§„ç‡</th>
                                <th>è¯„åˆ†</th>
                            </tr>
                        </thead>
                        <tbody id="contractorRanking">
                            <!-- åŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ–°å¢é¡¹ç›®æ¨¡æ€æ¡† -->
    <div id="addProjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">â• æ–°å¢è£…ä¿®é¡¹ç›®</div>
                <button class="close-btn" onclick="closeModal('addProjectModal')">&times;</button>
            </div>
            
            <form id="projectForm" onsubmit="return saveProject(event)">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label class="form-label">ç§Ÿæˆ·åç§° *</label>
                        <input type="text" class="form-control" required id="tenantName">
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ¥¼å±‚ *</label>
                        <input type="text" class="form-control" required id="floor" placeholder="ä¾‹å¦‚ï¼š18F">
                    </div>
                    <div class="form-group">
                        <label class="form-label">å•å…ƒå· *</label>
                        <input type="text" class="form-control" required id="unit" placeholder="ä¾‹å¦‚ï¼š1805">
                    </div>
                    <div class="form-group">
                        <label class="form-label">è£…ä¿®ç±»å‹ *</label>
                        <select class="form-control" required id="projectType">
                            <option value="åŠå…¬å®¤è£…ä¿®">åŠå…¬å®¤è£…ä¿®</option>
                            <option value="å±•å…æ”¹é€ ">å±•å…æ”¹é€ </option>
                            <option value="ä¼šè®®å®¤æ”¹é€ ">ä¼šè®®å®¤æ”¹é€ </option>
                            <option value="æ‰©ç§Ÿè£…ä¿®">æ‰©ç§Ÿè£…ä¿®</option>
                            <option value="åŠå…¬å®¤ç¿»æ–°">åŠå…¬å®¤ç¿»æ–°</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">è£…ä¿®é¢ç§¯(ã¡) *</label>
                        <input type="number" class="form-control" required id="area" min="50" max="1000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">åˆåŒé‡‘é¢(å…ƒ) *</label>
                        <input type="number" class="form-control" required id="amount" min="50000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ–½å·¥æ–¹ *</label>
                        <input type="text" class="form-control" required id="contractor">
                    </div>
                    <div class="form-group">
                        <label class="form-label">è´Ÿè´£äºº *</label>
                        <input type="text" class="form-control" required id="manager">
                    </div>
                    <div class="form-group">
                        <label class="form-label">è”ç³»ç”µè¯ *</label>
                        <input type="tel" class="form-control" required id="phone">
                    </div>
                    <div class="form-group">
                        <label class="form-label">åˆåŒå¼€å§‹æ—¥æœŸ *</label>
                        <input type="date" class="form-control" required id="startDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">åˆåŒç»“æŸæ—¥æœŸ *</label>
                        <input type="date" class="form-control" required id="endDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">é¢„è®¡å·¥æœŸ(å¤©)</label>
                        <input type="number" class="form-control" id="estimatedDays" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">åˆå§‹çŠ¶æ€</label>
                        <select class="form-control" id="initialStatus">
                            <option value="å®¡æ‰¹ä¸­">å®¡æ‰¹ä¸­</option>
                            <option value="å¾…è¿›åœº">å¾…è¿›åœº</option>
                            <option value="æ–½å·¥ä¸­" selected>æ–½å·¥ä¸­</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">å¤‡æ³¨</label>
                    <textarea class="form-control" rows="2" id="remarks" placeholder="é¡¹ç›®ç‰¹æ®Šè¦æ±‚æˆ–æ³¨æ„äº‹é¡¹..."></textarea>
                </div>
                
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn btn-warning" onclick="generateRandomProject()">ğŸ² ç”Ÿæˆéšæœºé¡¹ç›®</button>
                    <button type="submit" class="btn btn-success">ğŸ’¾ ä¿å­˜é¡¹ç›®</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- æ‰¹é‡æ“ä½œæ¨¡æ€æ¡† -->
    <div id="batchModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ“ æ‰¹é‡æ“ä½œ</div>
                <button class="close-btn" onclick="closeModal('batchModal')">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">é€‰æ‹©æ“ä½œç±»å‹</label>
                <select class="form-control" id="batchAction">
                    <option value="updateStatus">æ›´æ–°çŠ¶æ€</option>
                    <option value="markInspection">æ ‡è®°å·¡æ£€</option>
                    <option value="addProgress">æ›´æ–°è¿›åº¦</option>
                </select>
            </div>
            
            <div id="batchContent">
                <!-- åŠ¨æ€å†…å®¹ -->
            </div>
            
            <button class="btn btn-success" onclick="executeBatchAction()">âœ… æ‰§è¡Œæ‰¹é‡æ“ä½œ</button>
        </div>
    </div>

    <!-- å¼•å…¥Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <script>
        // æ•°æ®å­˜å‚¨
        let projects = [];
        let inspections = [];
        let selectedProjects = new Set();
        
        // åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
        function initSampleData() {
            projects = [
                {
                    id: 'P24001',
                    tenant: 'å®è¿œç§‘æŠ€',
                    floor: '18F',
                    unit: '1805',
                    type: 'å±•å…æ”¹é€ ',
                    area: 350,
                    amount: 280000,
                    startDate: '2024-01-10',
                    endDate: '2024-02-20',
                    actualStart: '2024-01-12',
                    status: 'æ–½å·¥ä¸­',
                    contractor: 'åŸå»ºè£…é¥°',
                    manager: 'ç‹ç»ç†',
                    phone: '138****5678',
                    progress: 65,
                    remarks: 'é‡ç‚¹å®¢æˆ·ï¼Œéœ€æ¯æ—¥å·¡æ£€'
                },
                {
                    id: 'P24002',
                    tenant: 'åˆ›æ„è®¾è®¡',
                    floor: '12F',
                    unit: '1202',
                    type: 'åŠå…¬å®¤è£…ä¿®',
                    area: 180,
                    amount: 150000,
                    startDate: '2024-01-15',
                    endDate: '2024-03-01',
                    actualStart: '2024-01-15',
                    status: 'æ–½å·¥ä¸­',
                    contractor: 'ç¾å±…è£…é¥°',
                    manager: 'æå·¥',
                    phone: '139****1234',
                    progress: 45,
                    remarks: 'åŠ¨ç«ä½œä¸šå¤šï¼Œéœ€é‡ç‚¹ç›‘ç®¡'
                }
            ];
            
            inspections = [
                {
                    id: 'INS001',
                    projectId: 'P24001',
                    date: '2024-01-18',
                    inspector: 'å¼ ä¸‰',
                    problemType: 'æ¶ˆé˜²è¿è§„',
                    description: 'ç­ç«å™¨è¢«å»ºç­‘ææ–™é®æŒ¡',
                    severity: 'ä¸­',
                    rectifyDate: '2024-01-19',
                    rectifyStatus: 'å·²å®Œæˆ',
                    reviewPerson: 'æå››',
                    reviewDate: '2024-01-19'
                }
            ];
            
            updateAllViews();
        }
        
        // æ›´æ–°æ‰€æœ‰è§†å›¾
        function updateAllViews() {
            updateProjectList();
            updateInspectionList();
            updateDashboard();
            updateAnalysis();
            updateProjectSelect();
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        // æ˜¾ç¤ºæ–°å¢é¡¹ç›®è¡¨å•
        function showAddForm() {
            document.getElementById('startDate').value = new Date().toISOString().split('T')[0];
            let endDate = new Date();
            endDate.setDate(endDate.getDate() + 45);
            document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
            calculateEstimatedDays();
            
            showModal('addProjectModal');
        }
        
        // è®¡ç®—é¢„è®¡å·¥æœŸ
        function calculateEstimatedDays() {
            const start = new Date(document.getElementById('startDate').value);
            const end = new Date(document.getElementById('endDate').value);
            const diffTime = Math.abs(end - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            document.getElementById('estimatedDays').value = diffDays;
        }
        
        // ç”Ÿæˆéšæœºé¡¹ç›®
        function generateRandomProject() {
            const tenants = ['è…¾è®¯ç§‘æŠ€', 'é˜¿é‡Œå·´å·´', 'ç™¾åº¦ç§‘æŠ€', 'å­—èŠ‚è·³åŠ¨', 'åä¸ºæŠ€æœ¯', 'å°ç±³ç§‘æŠ€', 'äº¬ä¸œé›†å›¢', 'ç¾å›¢ç‚¹è¯„'];
            const contractors = ['ä¸­å»ºè£…é¥°', 'åæ¶¦å»ºè®¾', 'ä¸‡ç§‘è£…ä¿®', 'é¾™æ¹–å·¥ç¨‹', 'ä¿åˆ©è£…é¥°', 'æ’å¤§è£…é¥°', 'ç¢§æ¡‚å›­å·¥ç¨‹'];
            const types = ['åŠå…¬å®¤è£…ä¿®', 'å±•å…æ”¹é€ ', 'ä¼šè®®å®¤æ”¹é€ ', 'æ‰©ç§Ÿè£…ä¿®', 'åŠå…¬å®¤ç¿»æ–°'];
            
            document.getElementById('tenantName').value = tenants[Math.floor(Math.random() * tenants.length)];
            document.getElementById('floor').value = (Math.floor(Math.random() * 25) + 1) + 'F';
            document.getElementById('unit').value = Math.floor(Math.random() * 20 + 1000);
            document.getElementById('projectType').value = types[Math.floor(Math.random() * types.length)];
            document.getElementById('area').value = Math.floor(Math.random() * 300 + 50);
            document.getElementById('amount').value = Math.floor(Math.random() * 200000 + 50000);
            document.getElementById('contractor').value = contractors[Math.floor(Math.random() * contractors.length)];
            document.getElementById('manager').value = ['å¼ ç»ç†', 'æç»ç†', 'ç‹æ€»', 'é™ˆå·¥', 'åˆ˜å·¥'][Math.floor(Math.random() * 5)];
            document.getElementById('phone').value = '138' + Math.floor(Math.random() * 100000000).toString().padStart(8, '0');
            
            const start = new Date();
            start.setDate(start.getDate() + Math.floor(Math.random() * 30));
            document.getElementById('startDate').value = start.toISOString().split('T')[0];
            
            const end = new Date(start);
            end.setDate(end.getDate() + Math.floor(Math.random() * 60 + 30));
            document.getElementById('endDate').value = end.toISOString().split('T')[0];
            
            calculateEstimatedDays();
        }
        
        // ä¿å­˜é¡¹ç›®
        function saveProject(event) {
            event.preventDefault();
            
            const projectId = 'P' + new Date().getFullYear().toString().substr(2) + 
                            String(Math.floor(Math.random() * 900) + 100).padStart(3, '0');
            
            const project = {
                id: projectId,
                tenant: document.getElementById('tenantName').value,
                floor: document.getElementById('floor').value,
                unit: document.getElementById('unit').value,
                type: document.getElementById('projectType').value,
                area: parseInt(document.getElementById('area').value),
                amount: parseInt(document.getElementById('amount').value),
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                actualStart: document.getElementById('initialStatus').value === 'æ–½å·¥ä¸­' ? 
                            document.getElementById('startDate').value : '',
                status: document.getElementById('initialStatus').value,
                contractor: document.getElementById('contractor').value,
                manager: document.getElementById('manager').value,
                phone: document.getElementById('phone').value,
                progress: document.getElementById('initialStatus').value === 'æ–½å·¥ä¸­' ? 
                         Math.floor(Math.random() * 30) + 10 : 0,
                remarks: document.getElementById('remarks').value
            };
            
            projects.push(project);
            updateAllViews();
            closeModal('addProjectModal');
            alert('é¡¹ç›®ä¿å­˜æˆåŠŸï¼é¡¹ç›®ID: ' + projectId);
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('projectForm').reset();
        }
        
        // ç”Ÿæˆç¤ºä¾‹æ•°æ®
        function generateSampleData() {
            // ç”Ÿæˆé¡¹ç›®æ•°æ®
            const sampleProjects = [
                {
                    id: 'P24003',
                    tenant: 'å¾‹å¸ˆäº‹åŠ¡æ‰€',
                    floor: '9F',
                    unit: '0911',
                    type: 'æ‰©ç§Ÿè£…ä¿®',
                    area: 220,
                    amount: 200000,
                    startDate: '2024-01-20',
                    endDate: '2024-03-10',
                    actualStart: '',
                    status: 'å®¡æ‰¹ä¸­',
                    contractor: 'åå»ºå·¥ç¨‹',
                    manager: 'å¼ æ€»',
                    phone: '137****8765',
                    progress: 0,
                    remarks: 'ç­‰å¾…æ¶ˆé˜²å±€æ‰¹å¤'
                },
                {
                    id: 'P24004',
                    tenant: 'é‡‘èå…¬å¸',
                    floor: '22F',
                    unit: '2208',
                    type: 'ä¼šè®®å®¤æ”¹é€ ',
                    area: 120,
                    amount: 100000,
                    startDate: '2024-01-05',
                    endDate: '2024-02-05',
                    actualStart: '2024-01-05',
                    status: 'å¾…éªŒæ”¶',
                    contractor: 'è¿…æ·è£…ä¿®',
                    manager: 'åˆ˜ç»ç†',
                    phone: '136****4321',
                    progress: 95,
                    remarks: 'æœ¬å‘¨å®‰æ’æœ€ç»ˆéªŒæ”¶'
                },
                {
                    id: 'P24005',
                    tenant: 'ç§‘æŠ€å…¬å¸',
                    floor: '15F',
                    unit: '1503',
                    type: 'åŠå…¬å®¤ç¿»æ–°',
                    area: 200,
                    amount: 180000,
                    startDate: '2024-01-08',
                    endDate: '2024-02-15',
                    actualStart: '2024-01-10',
                    status: 'æ–½å·¥ä¸­',
                    contractor: 'ç²¾å·¥è£…é¥°',
                    manager: 'é™ˆå·¥',
                    phone: '135****9876',
                    progress: 75,
                    remarks: 'è¿›åº¦æ­£å¸¸'
                }
            ];
            
            // ç”Ÿæˆå·¡æ£€æ•°æ®
            const sampleInspections = [
                {
                    id: 'INS002',
                    projectId: 'P24002',
                    date: '2024-01-18',
                    inspector: 'å¼ ä¸‰',
                    problemType: 'å®‰å…¨è¿è§„',
                    description: 'å·¥äººæœªæˆ´å®‰å…¨å¸½',
                    severity: 'é«˜',
                    rectifyDate: '2024-01-18',
                    rectifyStatus: 'å¤„ç†ä¸­',
                    reviewPerson: '',
                    reviewDate: ''
                },
                {
                    id: 'INS003',
                    projectId: 'P24004',
                    date: '2024-01-17',
                    inspector: 'æå››',
                    problemType: 'å™ªéŸ³æ‰°æ°‘',
                    description: 'åˆé—´æ–½å·¥è¢«æŠ•è¯‰',
                    severity: 'ä¸­',
                    rectifyDate: '2024-01-18',
                    rectifyStatus: 'å·²å®Œæˆ',
                    reviewPerson: 'ç‹äº”',
                    reviewDate: '2024-01-18'
                }
            ];
            
            projects = [...projects, ...sampleProjects];
            inspections = [...inspections, ...sampleInspections];
            
            updateAllViews();
            alert('å·²ç”Ÿæˆç¤ºä¾‹æ•°æ®ï¼');
        }
        
        // æ›´æ–°é¡¹ç›®åˆ—è¡¨
        function updateProjectList() {
            const filterStatus = document.getElementById('filterStatus').value;
            const filterFloor = document.getElementById('filterFloor').value.toLowerCase();
            const filterContractor = document.getElementById('filterContractor').value.toLowerCase();
            
            const filteredProjects = projects.filter(project => {
                return (!filterStatus || project.status === filterStatus) &&
                       (!filterFloor || project.floor.toLowerCase().includes(filterFloor)) &&
                       (!filterContractor || project.contractor.toLowerCase().includes(filterContractor));
            });
            
            const tbody = document.getElementById('projectList');
            tbody.innerHTML = '';
            
            filteredProjects.forEach(project => {
                const isSelected = selectedProjects.has(project.id);
                const row = document.createElement('tr');
                if (isSelected) row.classList.add('selected');
                
                const estimatedDays = Math.ceil((new Date(project.endDate) - new Date(project.startDate)) / (1000 * 60 * 60 * 24));
                const actualDays = project.actualStart ? 
                    Math.ceil((new Date() - new Date(project.actualStart)) / (1000 * 60 * 60 * 24)) : 0;
                const progressPercent = project.progress || 0;
                
                row.innerHTML = `
                    <td><input type="checkbox" onchange="toggleProjectSelection('${project.id}')" ${isSelected ? 'checked' : ''}></td>
                    <td><strong>${project.id}</strong></td>
                    <td>${project.tenant}</td>
                    <td>${project.floor}-${project.unit}</td>
                    <td>${project.type}</td>
                    <td>${project.area}ã¡</td>
                    <td>${project.startDate} è‡³ ${project.endDate}<br><small>é¢„è®¡${estimatedDays}å¤©</small></td>
                    <td><span class="status-badge status-${getStatusClass(project.status)}">${project.status}</span></td>
                    <td>${project.contractor}</td>
                    <td>${project.manager}<br><small>${project.phone}</small></td>
                    <td>
                        <div style="background: #f0f0f0; height: 20px; border-radius: 10px; overflow: hidden;">
                            <div style="background: #52c41a; height: 100%; width: ${progressPercent}%; 
                                        text-align: center; color: white; font-size: 12px; line-height: 20px;">
                                ${progressPercent}%
                            </div>
                        </div>
                        ${actualDays > 0 ? `<small>å·²æ–½å·¥${actualDays}å¤©</small>` : ''}
                    </td>
                    <td>
                        <button class="mark-btn" onclick="updateProjectStatus('${project.id}', 'æ–½å·¥ä¸­')" style="background: #e6f7ff; color: #1890ff;">å¼€å·¥</button>
                        <button class="mark-btn" onclick="updateProjectStatus('${project.id}', 'å¾…éªŒæ”¶')" style="background: #f6ffed; color: #52c41a;">å¾…éªŒ</button>
                        <button class="mark-btn" onclick="updateProjectStatus('${project.id}', 'å·²å®Œæˆ')" style="background: #d9f7be; color: #389e0d;">å®Œå·¥</button>
                        <button class="mark-btn" onclick="updateProjectStatus('${project.id}', 'å·²é€¾æœŸ')" style="background: #fff1f0; color: #ff4d4f;">é€¾æœŸ</button>
                        <button class="mark-btn" onclick="editProject('${project.id}')" style="background: #fff7e6; color: #fa8c16;">ç¼–è¾‘</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // è·å–çŠ¶æ€å¯¹åº”çš„CSSç±»
        function getStatusClass(status) {
            switch(status) {
                case 'å®¡æ‰¹ä¸­': return 'processing';
                case 'æ–½å·¥ä¸­': return 'processing';
                case 'å¾…éªŒæ”¶': return 'warning';
                case 'å·²å®Œæˆ': return 'completed';
                case 'å·²é€¾æœŸ': return 'delay';
                default: return 'new';
            }
        }
        
        // åˆ‡æ¢é¡¹ç›®é€‰æ‹©
        function toggleProjectSelection(projectId) {
            if (selectedProjects.has(projectId)) {
                selectedProjects.delete(projectId);
            } else {
                selectedProjects.add(projectId);
            }
            updateProjectList();
        }
        
        // æ›´æ–°é¡¹ç›®çŠ¶æ€
        function updateProjectStatus(projectId, newStatus) {
            const project = projects.find(p => p.id === projectId);
            if (project) {
                project.status = newStatus;
                
                // å¦‚æœæ˜¯"æ–½å·¥ä¸­"çŠ¶æ€ä¸”è¿˜æœªè®°å½•å®é™…å¼€å§‹æ—¥æœŸï¼Œåˆ™è®°å½•å½“å‰æ—¥æœŸ
                if (newStatus === 'æ–½å·¥ä¸­' && !project.actualStart) {
                    project.actualStart = new Date().toISOString().split('T')[0];
                    project.progress = Math.floor(Math.random() * 20) + 5;
                }
                
                // å¦‚æœæ˜¯"å·²å®Œæˆ"çŠ¶æ€ï¼Œè¿›åº¦è®¾ä¸º100%
                if (newStatus === 'å·²å®Œæˆ') {
                    project.progress = 100;
                }
                
                updateAllViews();
                alert(`é¡¹ç›® ${projectId} çŠ¶æ€å·²æ›´æ–°ä¸º ${newStatus}`);
            }
        }
        
        // æ‰¹é‡æ›´æ–°çŠ¶æ€
        function batchUpdateStatus() {
            if (selectedProjects.size === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦æ“ä½œçš„é¡¹ç›®ï¼');
                return;
            }
            
            document.getElementById('batchContent').innerHTML = `
                <div class="form-group">
                    <label class="form-label">é€‰æ‹©æ–°çš„çŠ¶æ€</label>
                    <select class="form-control" id="newBatchStatus">
                        <option value="æ–½å·¥ä¸­">æ–½å·¥ä¸­</option>
                        <option value="å¾…éªŒæ”¶">å¾…éªŒæ”¶</option>
                        <option value="å·²å®Œæˆ">å·²å®Œæˆ</option>
                        <option value="å·²é€¾æœŸ">å·²é€¾æœŸ</option>
                    </select>
                </div>
                <p>å°†å¯¹ ${selectedProjects.size} ä¸ªé¡¹ç›®è¿›è¡ŒçŠ¶æ€æ›´æ–°</p>
            `;
            
            showModal('batchModal');
        }
        
        // æ‰§è¡Œæ‰¹é‡æ“ä½œ
        function executeBatchAction() {
            const action = document.getElementById('batchAction').value;
            
            if (action === 'updateStatus') {
                const newStatus = document.getElementById('newBatchStatus').value;
                selectedProjects.forEach(projectId => {
                    updateProjectStatus(projectId, newStatus);
                });
                alert(`å·²æ‰¹é‡æ›´æ–° ${selectedProjects.size} ä¸ªé¡¹ç›®çŠ¶æ€ä¸º ${newStatus}`);
            }
            
            selectedProjects.clear();
            updateAllViews();
            closeModal('batchModal');
        }
        
        // æ‰¹é‡åˆ é™¤
        function batchDelete() {
            if (selectedProjects.size === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„é¡¹ç›®ï¼');
                return;
            }
            
            if (confirm(`ç¡®è®¤è¦åˆ é™¤ ${selectedProjects.size} ä¸ªé¡¹ç›®å—ï¼Ÿ`)) {
                projects = projects.filter(project => !selectedProjects.has(project.id));
                selectedProjects.clear();
                updateAllViews();
                alert('åˆ é™¤æˆåŠŸï¼');
            }
        }
        
        // æ›´æ–°å·¡æ£€è®°å½•åˆ—è¡¨
        function updateInspectionList() {
            const tbody = document.getElementById('inspectionList');
            tbody.innerHTML = '';
            
            inspections.forEach(inspection => {
                const project = projects.find(p => p.id === inspection.projectId);
                const location = project ? `${project.floor}-${project.unit}` : 'æœªçŸ¥';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${inspection.date}</td>
                    <td>${inspection.projectId}</td>
                    <td>${location}</td>
                    <td>${inspection.inspector}</td>
                    <td>${inspection.problemType}</td>
                    <td><span class="status-badge status-${inspection.severity === 'é«˜' ? 'delay' : inspection.severity === 'ä¸­' ? 'warning' : 'completed'}">
                        ${inspection.severity}
                    </span></td>
                    <td>${inspection.rectifyDate}</td>
                    <td><span class="status-badge status-${inspection.rectifyStatus === 'å·²å®Œæˆ' ? 'completed' : 'processing'}">
                        ${inspection.rectifyStatus}
                    </span></td>
                    <td>
                        <button class="mark-btn" onclick="markRectification('${inspection.id}', 'å·²å®Œæˆ')">æ•´æ”¹å®Œæˆ</button>
                        <button class="mark-btn" onclick="markRectification('${inspection.id}', 'å¤„ç†ä¸­')">å¤„ç†ä¸­</button>
                        <button class="mark-btn" onclick="deleteInspection('${inspection.id}')">åˆ é™¤</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // æ ‡è®°æ•´æ”¹çŠ¶æ€
        function markRectification(inspectionId, status) {
            const inspection = inspections.find(i => i.id === inspectionId);
            if (inspection) {
                inspection.rectifyStatus = status;
                if (status === 'å·²å®Œæˆ') {
                    inspection.reviewPerson = ['å¼ ä¸‰', 'æå››', 'ç‹äº”'][Math.floor(Math.random() * 3)];
                    inspection.reviewDate = new Date().toISOString().split('T')[0];
                }
                updateInspectionList();
                alert('æ•´æ”¹çŠ¶æ€å·²æ›´æ–°ï¼');
            }
        }
        
        // æ·»åŠ å·¡æ£€è®°å½•
        function addInspectionRecord(event) {
            event.preventDefault();
            
            const inspectionId = 'INS' + String(Math.floor(Math.random() * 900) + 100).padStart(3, '0');
            
            const inspection = {
                id: inspectionId,
                projectId: document.getElementById('inspectionProjectId').value,
                date: document.getElementById('inspectionDate').value,
                inspector: document.getElementById('inspector').value,
                problemType: document.getElementById('problemType').value,
                description: document.getElementById('problemDescription').value,
                severity: document.getElementById('severity').value,
                rectifyDate: document.getElementById('rectifyDate').value,
                rectifyStatus: 'å¤„ç†ä¸­',
                reviewPerson: '',
                reviewDate: ''
            };
            
            inspections.push(inspection);
            updateAllViews();
            alert('å·¡æ£€è®°å½•æ·»åŠ æˆåŠŸï¼');
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('inspectionForm').reset();
            document.getElementById('inspectionDate').value = new Date().toISOString().split('T')[0];
        }
        
        // ç”Ÿæˆéšæœºå·¡æ£€è®°å½•
        function generateRandomInspection() {
            if (projects.length === 0) {
                alert('è¯·å…ˆåˆ›å»ºé¡¹ç›®ï¼');
                return;
            }
            
            const problemTypes = ['æ¶ˆé˜²è¿è§„', 'å®‰å…¨è¿è§„', 'ç‰©æ–™å †æ”¾', 'å™ªéŸ³æ‰°æ°‘', 'ç¯å¢ƒå«ç”Ÿ', 'æ–½å·¥å®‰å…¨'];
            const descriptions = [
                'ç­ç«å™¨è¢«é®æŒ¡æ— æ³•ä½¿ç”¨',
                'å·¥äººæœªä½©æˆ´å®‰å…¨å¸½',
                'å»ºç­‘ææ–™å µå¡å®‰å…¨é€šé“',
                'æ–½å·¥æ—¶é—´è¶…å‡ºè§„å®šæ—¶æ®µ',
                'æ–½å·¥åŒºåŸŸå«ç”ŸçŠ¶å†µå·®',
                'ä¸´æ—¶ç”¨ç”µçº¿è·¯ä¸è§„èŒƒ',
                'åŠ¨ç«ä½œä¸šæ— ç›‘æŠ¤äºº',
                'é«˜ç©ºä½œä¸šæ— å®‰å…¨æªæ–½'
            ];
            
            const randomProject = projects[Math.floor(Math.random() * projects.length)];
            const today = new Date();
            const rectifyDate = new Date(today);
            rectifyDate.setDate(rectifyDate.getDate() + Math.floor(Math.random() * 3) + 1);
            
            document.getElementById('inspectionProjectId').value = randomProject.id;
            document.getElementById('inspectionDate').value = today.toISOString().split('T')[0];
            document.getElementById('inspector').value = ['å¼ ä¸‰', 'æå››', 'ç‹äº”'][Math.floor(Math.random() * 3)];
            document.getElementById('problemType').value = problemTypes[Math.floor(Math.random() * problemTypes.length)];
            document.getElementById('severity').value = ['ä½', 'ä¸­', 'é«˜'][Math.floor(Math.random() * 3)];
            document.getElementById('problemDescription').value = descriptions[Math.floor(Math.random() * descriptions.length)];
            document.getElementById('rectifyDate').value = rectifyDate.toISOString().split('T')[0];
        }
        
        // æ›´æ–°é¡¹ç›®é€‰æ‹©ä¸‹æ‹‰æ¡†
        function updateProjectSelect() {
            const select = document.getElementById('inspectionProjectId');
            select.innerHTML = '<option value="">é€‰æ‹©é¡¹ç›®</option>';
            
            projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = `${project.id} - ${project.tenant} (${project.floor}-${project.unit})`;
                select.appendChild(option);
            });
        }
        
        // æ›´æ–°ä»ªè¡¨æ¿
        function updateDashboard() {
            const activeProjects = projects.filter(p => p.status === 'æ–½å·¥ä¸­' || p.status === 'å¾…éªŒæ”¶').length;
            const totalArea = projects.reduce((sum, p) => sum + p.area, 0);
            const violations = inspections.length;
            const inspectionRate = inspections.filter(i => i.rectifyStatus === 'å·²å®Œæˆ').length / inspections.length * 100 || 0;
            
            document.getElementById('kpiActive').textContent = activeProjects;
            document.getElementById('kpiArea').textContent = totalArea + 'ã¡';
            document.getElementById('kpiViolation').textContent = violations + 'æ¬¡';
            document.getElementById('kpiInspection').textContent = inspectionRate.toFixed(0) + '%';
            
            // æ›´æ–°çŠ¶æ€åˆ†å¸ƒ
            updateStatusDistribution();
            
            // æ›´æ–°é¢„è­¦ä¿¡æ¯
            updateWarningList();
        }
        
        // æ›´æ–°çŠ¶æ€åˆ†å¸ƒ
        function updateStatusDistribution() {
            const tbody = document.getElementById('statusDistribution');
            tbody.innerHTML = '';
            
            const statusCount = {};
            projects.forEach(project => {
                statusCount[project.status] = (statusCount[project.status] || 0) + 1;
            });
            
            const total = projects.length;
            const statuses = ['å®¡æ‰¹ä¸­', 'æ–½å·¥ä¸­', 'å¾…éªŒæ”¶', 'å·²å®Œæˆ', 'å·²é€¾æœŸ'];
            
            statuses.forEach(status => {
                const count = statusCount[status] || 0;
                const percentage = total > 0 ? (count / total * 100).toFixed(1) : 0;
                const area = projects.filter(p => p.status === status).reduce((sum, p) => sum + p.area, 0);
                
                // è®¡ç®—å¹³å‡å·¥æœŸï¼ˆä»…é’ˆå¯¹å·²å®Œæˆæˆ–æœ‰å®é™…å¼€å§‹æ—¥æœŸçš„é¡¹ç›®ï¼‰
                const relevantProjects = projects.filter(p => p.status === status && p.actualStart);
                const avgDays = relevantProjects.length > 0 ? 
                    Math.round(relevantProjects.reduce((sum, p) => {
                        const start = new Date(p.actualStart);
                        const end = p.status === 'å·²å®Œæˆ' ? new Date(p.endDate) : new Date();
                        return sum + Math.ceil((end - start) / (1000 * 60 * 60 * 24));
                    }, 0) / relevantProjects.length) : '-';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="status-badge status-${getStatusClass(status)}">${status}</span></td>
                    <td>${count}</td>
                    <td>${percentage}%</td>
                    <td>${area}ã¡</td>
                    <td>${avgDays}å¤©</td>
                    <td>
                        <button class="mark-btn" onclick="filterByStatus('${status}')">æŸ¥çœ‹</button>
                        <button class="mark-btn" onclick="exportStatusProjects('${status}')">å¯¼å‡º</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // æŒ‰çŠ¶æ€ç­›é€‰
        function filterByStatus(status) {
            document.getElementById('filterStatus').value = status;
            filterProjects();
            switchTab('projects');
        }
        
        // ç­›é€‰é¡¹ç›®
        function filterProjects() {
            updateProjectList();
        }
        
        // æ›´æ–°é¢„è­¦åˆ—è¡¨
        function updateWarningList() {
            const warningList = document.getElementById('warningList');
            warningList.innerHTML = '';
            
            // æ£€æŸ¥é€¾æœŸé¡¹ç›®
            const today = new Date();
            projects.forEach(project => {
                const endDate = new Date(project.endDate);
                if (endDate < today && project.status !== 'å·²å®Œæˆ') {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <div style="background: #fff1f0; padding: 8px; margin: 5px 0; border-radius: 4px;">
                            ğŸ”´ <strong>${project.id} - ${project.tenant}</strong> (${project.floor}-${project.unit})<br>
                            é¡¹ç›®å·²é€¾æœŸ ${Math.ceil((today - endDate) / (1000 * 60 * 60 * 24))} å¤©ï¼
                        </div>
                    `;
                    warningList.appendChild(div);
                }
            });
            
            // æ£€æŸ¥è¶…æœŸæœªæ•´æ”¹çš„å·¡æ£€
            inspections.forEach(inspection => {
                const rectifyDate = new Date(inspection.rectifyDate);
                if (rectifyDate < today && inspection.rectifyStatus !== 'å·²å®Œæˆ') {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <div style="background: #fff7e6; padding: 8px; margin: 5px 0; border-radius: 4px;">
                            ğŸŸ¡ <strong>${inspection.projectId} - ${inspection.problemType}</strong><br>
                            æ•´æ”¹å·²é€¾æœŸï¼Œè¯·ç«‹å³å¤„ç†ï¼
                        </div>
                    `;
                    warningList.appendChild(div);
                }
            });
        }
        
        // æ›´æ–°æ•°æ®åˆ†æ
        function updateAnalysis() {
            // æ›´æ–°æœˆåº¦ç»Ÿè®¡
            updateMonthlyStats();
            
            // æ›´æ–°æ–½å·¥æ–¹æ’å
            updateContractorRanking();
            
            // æ›´æ–°å›¾è¡¨
            updateCharts();
        }
        
        // æ›´æ–°æœˆåº¦ç»Ÿè®¡
        function updateMonthlyStats() {
            const tbody = document.getElementById('monthlyStats');
            tbody.innerHTML = '';
            
            const months = ['2023-11', '2023-12', '2024-01'];
            months.forEach(month => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${month}</td>
                    <td>${Math.floor(Math.random() * 5) + 2}</td>
                    <td>${Math.floor(Math.random() * 4) + 1}</td>
                    <td>${Math.floor(Math.random() * 8) + 4}</td>
                    <td>${Math.floor(Math.random() * 30) + 20}</td>
                    <td>${Math.floor(Math.random() * 15) + 80}%</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // æ›´æ–°æ–½å·¥æ–¹æ’å
        function updateContractorRanking() {
            const tbody = document.getElementById('contractorRanking');
            tbody.innerHTML = '';
            
            const contractorStats = {};
            projects.forEach(project => {
                if (!contractorStats[project.contractor]) {
                    contractorStats[project.contractor] = {
                        projects: 0,
                        totalArea: 0,
                        violations: 0
                    };
                }
                contractorStats[project.contractor].projects++;
                contractorStats[project.contractor].totalArea += project.area;
            });
            
            inspections.forEach(inspection => {
                const project = projects.find(p => p.id === inspection.projectId);
                if (project && contractorStats[project.contractor]) {
                    contractorStats[project.contractor].violations++;
                }
            });
            
            const rankings = Object.keys(contractorStats).map(contractor => {
                const stats = contractorStats[contractor];
                const score = 100 - (stats.violations * 5) + (stats.projects * 10);
                return {
                    contractor,
                    ...stats,
                    score: Math.max(60, Math.min(100, score))
                };
            }).sort((a, b) => b.score - a.score);
            
            rankings.forEach((rank, index) => {
                const row = document.createElement('tr');
                const grade = rank.score >= 90 ? 'A+' : rank.score >= 80 ? 'A' : rank.score >= 70 ? 'B' : 'C';
                const gradeColor = rank.score >= 90 ? '#52c41a' : rank.score >= 80 ? '#1890ff' : rank.score >= 70 ? '#fa8c16' : '#ff4d4f';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${rank.contractor}</td>
                    <td>${rank.projects}</td>
                    <td>${Math.floor(Math.random() * 10) + 25}å¤©</td>
                    <td>${Math.floor(Math.random() * 20) + 5}%</td>
                    <td style="color: ${gradeColor}; font-weight: bold;">${grade} (${rank.score}åˆ†)</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // æ›´æ–°å›¾è¡¨
        function updateCharts() {
            // é—®é¢˜ç±»å‹åˆ†å¸ƒå›¾
            const problemTypes = {};
            inspections.forEach(inspection => {
                problemTypes[inspection.problemType] = (problemTypes[inspection.problemType] || 0) + 1;
            });
            
            const problemTypeCtx = document.getElementById('problemTypeChart').getContext('2d');
            new Chart(problemTypeCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(problemTypes),
                    datasets: [{
                        data: Object.values(problemTypes),
                        backgroundColor: ['#ff4d4f', '#fa8c16', '#1890ff', '#52c41a', '#722ed1', '#13c2c2']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // å¯¼å‡ºåˆ°Excel
        function exportToExcel() {
            // åˆ›å»ºå·¥ä½œç°¿
            const wb = XLSX.utils.book_new();
            
            // é¡¹ç›®æ•°æ®è¡¨
            const projectData = [
                ['é¡¹ç›®ID', 'ç§Ÿæˆ·åç§°', 'æ¥¼å±‚', 'å•å…ƒå·', 'è£…ä¿®ç±»å‹', 'é¢ç§¯(ã¡)', 'åˆåŒé‡‘é¢', 'åˆåŒå¼€å§‹', 'åˆåŒç»“æŸ', 'å®é™…å¼€å§‹', 'çŠ¶æ€', 'æ–½å·¥æ–¹', 'è´Ÿè´£äºº', 'è”ç³»ç”µè¯', 'è¿›åº¦%', 'å¤‡æ³¨'],
                ...projects.map(p => [
                    p.id, p.tenant, p.floor, p.unit, p.type, p.area, p.amount, 
                    p.startDate, p.endDate, p.actualStart, p.status, p.contractor, 
                    p.manager, p.phone, p.progress + '%', p.remarks
                ])
            ];
            
            const wsProjects = XLSX.utils.aoa_to_sheet(projectData);
            XLSX.utils.book_append_sheet(wb, wsProjects, "é¡¹ç›®æ•°æ®");
            
            // å·¡æ£€æ•°æ®è¡¨
            const inspectionData = [
                ['å·¡æ£€ID', 'é¡¹ç›®ID', 'å·¡æ£€æ—¥æœŸ', 'å·¡æ£€äºº', 'é—®é¢˜ç±»å‹', 'é—®é¢˜æè¿°', 'ä¸¥é‡ç¨‹åº¦', 'æ•´æ”¹æœŸé™', 'æ•´æ”¹çŠ¶æ€', 'å¤æŸ¥äºº', 'å¤æŸ¥æ—¥æœŸ'],
                ...inspections.map(i => [
                    i.id, i.projectId, i.date, i.inspector, i.problemType, i.description, 
                    i.severity, i.rectifyDate, i.rectifyStatus, i.reviewPerson, i.reviewDate
                ])
            ];
            
            const wsInspections = XLSX.utils.aoa_to_sheet(inspectionData);
            XLSX.utils.book_append_sheet(wb, wsInspections, "å·¡æ£€è®°å½•");
            
            // å¯¼å‡ºæ–‡ä»¶
            const fileName = `å†™å­—æ¥¼è£…ä¿®çœ‹æ¿_${new Date().toISOString().slice(0,10).replace(/-/g, '')}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            alert(`Excelæ–‡ä»¶å·²å¯¼å‡ºï¼š${fileName}`);
        }
        
        // å¯¼å‡ºé¡¹ç›®è¡¨
        function exportProjects() {
            const wb = XLSX.utils.book_new();
            
            const projectData = [
                ['é¡¹ç›®ID', 'ç§Ÿæˆ·åç§°', 'æ¥¼å±‚', 'å•å…ƒå·', 'è£…ä¿®ç±»å‹', 'é¢ç§¯(ã¡)', 'åˆåŒé‡‘é¢', 'åˆåŒå·¥æœŸ', 'å½“å‰çŠ¶æ€', 'æ–½å·¥æ–¹', 'è´Ÿè´£äºº', 'è”ç³»ç”µè¯', 'è¿›åº¦', 'å¤‡æ³¨'],
                ...projects.map(p => [
                    p.id, p.tenant, p.floor, p.unit, p.type, p.area, p.amount, 
                    `${p.startDate}è‡³${p.endDate}`, p.status, p.contractor, 
                    p.manager, p.phone, p.progress + '%', p.remarks
                ])
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(projectData);
            XLSX.utils.book_append_sheet(wb, ws, "é¡¹ç›®åˆ—è¡¨");
            
            const fileName = `è£…ä¿®é¡¹ç›®åˆ—è¡¨_${new Date().toISOString().slice(0,10).replace(/-/g, '')}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }
        
        // å¯¼å‡ºçŠ¶æ€é¡¹ç›®
        function exportStatusProjects(status) {
            const filteredProjects = projects.filter(p => p.status === status);
            
            if (filteredProjects.length === 0) {
                alert(`æ²¡æœ‰${status}çš„é¡¹ç›®ï¼`);
                return;
            }
            
            const wb = XLSX.utils.book_new();
            
            const projectData = [
                ['é¡¹ç›®ID', 'ç§Ÿæˆ·åç§°', 'æ¥¼å±‚', 'å•å…ƒå·', 'è£…ä¿®ç±»å‹', 'é¢ç§¯(ã¡)', 'åˆåŒé‡‘é¢', 'åˆåŒå¼€å§‹', 'åˆåŒç»“æŸ', 'æ–½å·¥æ–¹', 'è´Ÿè´£äºº', 'è”ç³»ç”µè¯', 'è¿›åº¦', 'å¤‡æ³¨'],
                ...filteredProjects.map(p => [
                    p.id, p.tenant, p.floor, p.unit, p.type, p.area, p.amount, 
                    p.startDate, p.endDate, p.contractor, p.manager, p.phone, p.progress + '%', p.remarks
                ])
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(projectData);
            XLSX.utils.book_append_sheet(wb, ws, `${status}é¡¹ç›®`);
            
            const fileName = `${status}é¡¹ç›®åˆ—è¡¨_${new Date().toISOString().slice(0,10).replace(/-/g, '')}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }
        
        // æ˜¾ç¤ºç»Ÿè®¡æ•°æ®
        function showStatistics() {
            const totalProjects = projects.length;
            const totalArea = projects.reduce((sum, p) => sum + p.area, 0);
            const totalInvestment = projects.reduce((sum, p) => sum + p.amount, 0);
            const violationRate = inspections.length / totalProjects || 0;
            
            alert(`ğŸ“Š ç»Ÿè®¡æ•°æ®ï¼š
â€¢ æ€»é¡¹ç›®æ•°ï¼š${totalProjects}ä¸ª
â€¢ æ€»è£…ä¿®é¢ç§¯ï¼š${totalArea}ã¡
â€¢ æ€»æŠ•èµ„é¢ï¼š${totalInvestment.toLocaleString()}å…ƒ
â€¢ å¹³å‡è¿è§„ç‡ï¼š${(violationRate * 100).toFixed(1)}%
â€¢ æ•´æ”¹å®Œæˆç‡ï¼š${(inspections.filter(i => i.rectifyStatus === 'å·²å®Œæˆ').length / inspections.length * 100 || 0).toFixed(1)}%`);
        }
        
        // æ¸…ç©ºæ‰€æœ‰æ•°æ®
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                projects = [];
                inspections = [];
                selectedProjects.clear();
                updateAllViews();
                alert('æ‰€æœ‰æ•°æ®å·²æ¸…ç©ºï¼');
            }
        }
        
        // é¡µé¢åŠ è½½åˆå§‹åŒ–
        window.onload = function() {
            initSampleData();
            document.getElementById('inspectionDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('rectifyDate').value = new Date(new Date().setDate(new Date().getDate() + 2)).toISOString().split('T')[0];
        };
        
        // ç›‘å¬æ—¥æœŸå˜åŒ–è®¡ç®—å·¥æœŸ
        document.getElementById('startDate').addEventListener('change', calculateEstimatedDays);
        document.getElementById('endDate').addEventListener('change', calculateEstimatedDays);
    </script>
</body>
</html>
