<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>写字楼二次装修管理系统</title>
    <style>
        /* 全局样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* 头部样式 */
        header {
            background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%);
            color: white;
            padding: 20px 0;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
        }
        
        .current-date {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* 主内容区 */
        .main-content {
            display: flex;
            gap: 20px;
        }
        
        .sidebar {
            width: 250px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .content-area {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        /* 导航菜单 */
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 10px;
        }
        
        .nav-link {
            display: block;
            padding: 12px 15px;
            color: #333;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s;
        }
        
        .nav-link:hover {
            background-color: #e6f7ff;
            color: #1890ff;
        }
        
        .nav-link.active {
            background-color: #1890ff;
            color: white;
        }
        
        .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        /* 统计卡片 */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 4px solid #1890ff;
        }
        
        .stat-card.warning {
            border-color: #fa8c16;
        }
        
        .stat-card.danger {
            border-color: #f5222d;
        }
        
        .stat-card.success {
            border-color: #52c41a;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        /* 表格样式 */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .data-table th {
            background-color: #fafafa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e8e8e8;
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #e8e8e8;
        }
        
        .data-table tr:hover {
            background-color: #fafafa;
        }
        
        /* 状态标签 */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-approval {
            background-color: #fff7e6;
            color: #fa8c16;
        }
        
        .status-construction {
            background-color: #e6f7ff;
            color: #1890ff;
        }
        
        .status-delay {
            background-color: #fff1f0;
            color: #f5222d;
        }
        
        .status-completed {
            background-color: #f6ffed;
            color: #52c41a;
        }
        
        /* 危险作业标签 */
        .danger-tag {
            display: inline-block;
            padding: 2px 8px;
            margin: 2px;
            background-color: #fff1f0;
            color: #f5222d;
            border-radius: 4px;
            font-size: 12px;
            border: 1px solid #ffa39e;
        }
        
        /* 表单样式 */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24,144,255,0.2);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        /* 按钮样式 */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #1890ff;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #096dd9;
        }
        
        .btn-success {
            background-color: #52c41a;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #389e0d;
        }
        
        .btn-danger {
            background-color: #f5222d;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #cf1322;
        }
        
        .btn-group {
            display: flex;
            gap: 8px;
        }
        
        /* 操作按钮 */
        .action-btn {
            padding: 4px 8px;
            margin: 2px;
            font-size: 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .edit-btn {
            background-color: #1890ff;
            color: white;
        }
        
        .delete-btn {
            background-color: #ff4d4f;
            color: white;
        }
        
        .mark-btn {
            background-color: #fa8c16;
            color: white;
        }
        
        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            position: relative;
            background: white;
            width: 90%;
            max-width: 600px;
            margin: 50px auto;
            border-radius: 8px;
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        /* 复选框组 */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 5px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* 搜索和筛选 */
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 300px;
            padding: 10px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
        }
        
        .filter-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        /* 页面标题 */
        .page-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-building"></i> 写字楼装修管理系统
                </div>
                <div class="current-date" id="currentDate"></div>
            </div>
        </header>
        
        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 侧边栏 -->
            <aside class="sidebar">
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link active" onclick="showPage('dashboard')">
                            <i class="fas fa-tachometer-alt"></i> 总览看板
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showPage('projects')">
                            <i class="fas fa-project-diagram"></i> 项目管理
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showPage('danger')">
                            <i class="fas fa-exclamation-triangle"></i> 危险作业
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showPage('inspection')">
                            <i class="fas fa-clipboard-check"></i> 巡检记录
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showPage('statistics')">
                            <i class="fas fa-chart-bar"></i> 统计分析
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showPage('settings')">
                            <i class="fas fa-cog"></i> 系统设置
                        </a>
                    </li>
                </ul>
            </aside>
            
            <!-- 内容区域 -->
            <main class="content-area">
                <!-- 总览看板 -->
                <div id="dashboard-page" class="page-content active-page">
                    <h2 class="page-title">总览看板</h2>
                    
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-label">活跃项目</div>
                            <div class="stat-value" id="activeProjects">0</div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-label">危险作业</div>
                            <div class="stat-value" id="dangerOperations">0</div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-label">未处理预警</div>
                            <div class="stat-value" id="pendingWarnings">0</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-label">本月完工</div>
                            <div class="stat-value" id="completedThisMonth">0</div>
                        </div>
                    </div>
                    
                    <div class="search-box">
                        <input type="text" class="search-input" placeholder="搜索项目..." onkeyup="searchProjects(this.value)">
                    </div>
                    
                    <h3>最近项目</h3>
                    <table class="data-table" id="recentProjectsTable">
                        <thead>
                            <tr>
                                <th>项目ID</th>
                                <th>租户名称</th>
                                <th>楼层/单元</th>
                                <th>装修公司</th>
                                <th>装修类型</th>
                                <th>状态</th>
                                <th>危险作业</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="recentProjectsBody">
                            <!-- 动态生成 -->
                        </tbody>
                    </table>
                    
                    <h3 style="margin-top: 30px;">高风险预警</h3>
                    <table class="data-table" id="warningTable">
                        <thead>
                            <tr>
                                <th>紧急程度</th>
                                <th>项目</th>
                                <th>问题描述</th>
                                <th>发现时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="warningBody">
                            <!-- 动态生成 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 项目管理 -->
                <div id="projects-page" class="page-content" style="display: none;">
                    <div class="page-header">
                        <h2 class="page-title">项目管理</h2>
                        <button class="btn btn-primary" onclick="openNewProjectModal()">
                            <i class="fas fa-plus"></i> 新增项目
                        </button>
                    </div>
                    
                    <div class="filter-group">
                        <select class="form-control" style="width: 150px;" onchange="filterByStatus(this.value)">
                            <option value="">所有状态</option>
                            <option value="审批中">审批中</option>
                            <option value="施工中">施工中</option>
                            <option value="待验收">待验收</option>
                            <option value="已完工">已完工</option>
                        </select>
                        
                        <select class="form-control" style="width: 150px;" onchange="filterByFloor(this.value)">
                            <option value="">所有楼层</option>
                            <!-- 楼层选项动态生成 -->
                        </select>
                        
                        <input type="text" class="search-input" placeholder="搜索租户或项目ID..." onkeyup="searchProjectsTable(this.value)">
                    </div>
                    
                    <table class="data-table" id="projectsTable">
                        <thead>
                            <tr>
                                <th>项目ID</th>
                                <th>租户名称</th>
                                <th>楼层/单元</th>
                                <th>装修公司</th>
                                <th>装修类型</th>
                                <th>装修开始</th>
                                <th>装修结束</th>
                                <th>状态</th>
                                <th>危险作业</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="projectsBody">
                            <!-- 动态生成 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 危险作业管理 -->
                <div id="danger-page" class="page-content" style="display: none;">
                    <h2 class="page-title">危险作业管理</h2>
                    
                    <div class="stats-cards">
                        <div class="stat-card danger">
                            <div class="stat-label">高空作业</div>
                            <div class="stat-value" id="highWorkCount">0</div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-label">动火作业</div>
                            <div class="stat-value" id="fireWorkCount">0</div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-label">有限空间</div>
                            <div class="stat-value" id="limitedSpaceCount">0</div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-label">泄水作业</div>
                            <div class="stat-value" id="drainageCount">0</div>
                        </div>
                    </div>
                    
                    <table class="data-table" id="dangerTable">
                        <thead>
                            <tr>
                                <th>危险类型</th>
                                <th>项目信息</th>
                                <th>作业地点</th>
                                <th>计划时间</th>
                                <th>负责人</th>
                                <th>监护人员</th>
                                <th>审批状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="dangerBody">
                            <!-- 动态生成 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 巡检记录 -->
                <div id="inspection-page" class="page-content" style="display: none;">
                    <h2 class="page-title">巡检记录</h2>
                    
                    <button class="btn btn-primary" onclick="openNewInspectionModal()">
                        <i class="fas fa-plus"></i> 添加巡检记录
                    </button>
                    
                    <table class="data-table" id="inspectionTable">
                        <thead>
                            <tr>
                                <th>巡检日期</th>
                                <th>项目ID</th>
                                <th>巡检人</th>
                                <th>问题类型</th>
                                <th>问题描述</th>
                                <th>严重程度</th>
                                <th>整改状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="inspectionBody">
                            <!-- 动态生成 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 统计分析 -->
                <div id="statistics-page" class="page-content" style="display: none;">
                    <h2 class="page-title">统计分析</h2>
                    
                    <div class="form-row">
                        <select class="form-control" onchange="updateStatistics()">
                            <option value="month">本月数据</option>
                            <option value="quarter">本季度数据</option>
                            <option value="year">本年度数据</option>
                        </select>
                    </div>
                    
                    <div id="statisticsContent">
                        <!-- 统计图表和表格动态生成 -->
                    </div>
                </div>
                
                <!-- 系统设置 -->
                <div id="settings-page" class="page-content" style="display: none;">
                    <h2 class="page-title">系统设置</h2>
                    
                    <div class="form-group">
                        <label class="form-label">装修类型管理</label>
                        <div class="form-row">
                            <input type="text" id="newDecorationType" class="form-control" placeholder="新增装修类型">
                            <button class="btn btn-success" onclick="addDecorationType()">添加类型</button>
                        </div>
                        
                        <div id="decorationTypesList" style="margin-top: 15px;">
                            <!-- 装修类型列表 -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">危险作业类型</label>
                        <div id="dangerTypesList">
                            <!-- 危险作业类型列表 -->
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- 新增项目模态框 -->
    <div id="newProjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">新增装修项目</h3>
                <button class="close-btn" onclick="closeModal('newProjectModal')">&times;</button>
            </div>
            
            <form id="projectForm" onsubmit="saveProject(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">项目ID</label>
                        <input type="text" class="form-control" id="projectId" value="自动生成" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">租户名称 *</label>
                        <input type="text" class="form-control" id="tenantName" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">楼层 *</label>
                        <select class="form-control" id="floor" required>
                            <option value="">请选择楼层</option>
                            <!-- 楼层选项动态生成 -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">单元号 *</label>
                        <input type="text" class="form-control" id="unitNumber" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">装修公司 *</label>
                        <input type="text" class="form-control" id="decorationCompany" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">装修类型 *</label>
                        <div class="form-row">
                            <select class="form-control" id="decorationType" required>
                                <option value="">请选择类型</option>
                                <!-- 装修类型选项动态生成 -->
                            </select>
                            <button type="button" class="btn" onclick="openCustomTypeModal()">自定义</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">装修开始日期 *</label>
                        <input type="date" class="form-control" id="decorationStartDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">装修结束日期 *</label>
                        <input type="date" class="form-control" id="decorationEndDate" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">装修面积(㎡)</label>
                    <input type="number" class="form-control" id="decorationArea">
                </div>
                
                <div class="form-group">
                    <label class="form-label">项目负责人</label>
                    <input type="text" class="form-control" id="projectManager">
                </div>
                
                <div class="form-group">
                    <label class="form-label">联系电话</label>
                    <input type="tel" class="form-control" id="contactPhone">
                </div>
                
                <div class="form-group">
                    <label class="form-label">危险作业类型（可多选）</label>
                    <div class="checkbox-group" id="dangerCheckboxes">
                        <!-- 危险作业复选框动态生成 -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">备注</label>
                    <textarea class="form-control" id="projectRemark" rows="3"></textarea>
                </div>
                
                <div class="form-group" style="text-align: right;">
                    <button type="button" class="btn" onclick="closeModal('newProjectModal')">取消</button>
                    <button type="submit" class="btn btn-primary">保存项目</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 自定义装修类型模态框 -->
    <div id="customTypeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">自定义装修类型</h3>
                <button class="close-btn" onclick="closeModal('customTypeModal')">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">新的装修类型名称</label>
                <input type="text" class="form-control" id="customTypeName">
            </div>
            
            <div class="form-group" style="text-align: right;">
                <button type="button" class="btn" onclick="closeModal('customTypeModal')">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveCustomType()">保存</button>
            </div>
        </div>
    </div>
    
    <!-- 编辑项目模态框 -->
    <div id="editProjectModal" class="modal">
        <div class="modal-content">
            <!-- 编辑项目表单（结构与新增相似） -->
        </div>
    </div>
    
    <!-- 标记操作模态框 -->
    <div id="markModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">标记操作</h3>
                <button class="close-btn" onclick="closeModal('markModal')">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">标记类型</label>
                <select class="form-control" id="markType">
                    <option value="warning">问题预警</option>
                    <option value="danger">危险作业</option>
                    <option value="delay">进度延迟</option>
                    <option value="completed">完工验收</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">描述信息</label>
                <textarea class="form-control" id="markDescription" rows="4"></textarea>
            </div>
            
            <div class="form-group" style="text-align: right;">
                <button type="button" class="btn" onclick="closeModal('markModal')">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveMark()">确认标记</button>
            </div>
        </div>
    </div>

    <script>
        // 数据存储
        let projects = JSON.parse(localStorage.getItem('decorationProjects')) || [];
        let inspectionRecords = JSON.parse(localStorage.getItem('inspectionRecords')) || [];
        let decorationTypes = JSON.parse(localStorage.getItem('decorationTypes')) || [
            '办公室装修', '展厅改造', '会议室改造', '扩租装修', '办公室翻新',
            '卫生间改造', '强弱电改造', '消防系统改造', '空调系统改造', '外立面装修'
        ];
        let dangerOperations = JSON.parse(localStorage.getItem('dangerOperations')) || [];
        let currentProjectId = null;
        
        // 危险作业类型
        const DANGER_TYPES = [
            { id: 'high-altitude', name: '高空作业', color: '#f5222d' },
            { id: 'fire-work', name: '动火作业', color: '#fa8c16' },
            { id: 'drainage', name: '泄水作业', color: '#1890ff' },
            { id: 'limited-space', name: '有限空间作业', color: '#722ed1' }
        ];
        
        // 初始化
        function init() {
            updateCurrentDate();
            loadDashboardData();
            loadProjectsTable();
            loadDangerOperations();
            loadInspectionRecords();
            initSettings();
            
            // 设置默认日期
            const today = new Date();
            const endDate = new Date(today);
            endDate.setDate(today.getDate() + 30);
            
            document.getElementById('decorationStartDate').value = formatDate(today);
            document.getElementById('decorationEndDate').value = formatDate(endDate);
            
            // 初始化楼层选项
            initFloorOptions();
            // 初始化装修类型选项
            initDecorationTypeOptions();
            // 初始化危险作业复选框
            initDangerCheckboxes();
        }
        
        // 更新当前日期
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            };
            document.getElementById('currentDate').textContent = 
                now.toLocaleDateString('zh-CN', options);
        }
        
        // 加载仪表板数据
        function loadDashboardData() {
            // 统计活跃项目
            const activeProjects = projects.filter(p => 
                p.status === '施工中' || p.status === '审批中'
            ).length;
            document.getElementById('activeProjects').textContent = activeProjects;
            
            // 统计危险作业
            const dangerOps = projects.reduce((count, project) => {
                return count + (project.dangerOperations?.length || 0);
            }, 0);
            document.getElementById('dangerOperations').textContent = dangerOps;
            
            // 统计未处理预警
            const warnings = inspectionRecords.filter(r => 
                r.severity === '高' && r.status !== '已完成'
            ).length;
            document.getElementById('pendingWarnings').textContent = warnings;
            
            // 统计本月完工
            const thisMonth = new Date().getMonth();
            const completed = projects.filter(p => {
                if (p.status === '已完工' && p.completedDate) {
                    const completedMonth = new Date(p.completedDate).getMonth();
                    return completedMonth === thisMonth;
                }
                return false;
            }).length;
            document.getElementById('completedThisMonth').textContent = completed;
            
            // 加载最近项目
            loadRecentProjects();
            // 加载预警列表
            loadWarnings();
        }
        
        // 加载最近项目
        function loadRecentProjects() {
            const tbody = document.getElementById('recentProjectsBody');
            tbody.innerHTML = '';
            
            const recentProjects = projects.slice(0, 5); // 显示最近5个项目
            
            recentProjects.forEach(project => {
                const row = document.createElement('tr');
                
                // 危险作业标签
                const dangerTags = project.dangerOperations?.map(op => 
                    `<span class="danger-tag">${op}</span>`
                ).join('') || '';
                
                row.innerHTML = `
                    <td>${project.id}</td>
                    <td>${project.tenantName}</td>
                    <td>${project.floor}-${project.unitNumber}</td>
                    <td>${project.decorationCompany}</td>
                    <td>${project.decorationType}</td>
                    <td><span class="status-badge status-${getStatusClass(project.status)}">${project.status}</span></td>
                    <td>${dangerTags}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editProject('${project.id}')">编辑</button>
                        <button class="action-btn mark-btn" onclick="openMarkModal('${project.id}')">标记</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // 加载预警列表
        function loadWarnings() {
            const tbody = document.getElementById('warningBody');
            tbody.innerHTML = '';
            
            const highSeverityWarnings = inspectionRecords
                .filter(r => r.severity === '高' && r.status !== '已完成')
                .slice(0, 5);
            
            highSeverityWarnings.forEach(warning => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="status-badge status-delay">高风险</span></td>
                    <td>${warning.projectId}</td>
                    <td>${warning.description}</td>
                    <td>${warning.date}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="handleWarning('${warning.id}')">处理</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // 加载项目表格
        function loadProjectsTable() {
            const tbody = document.getElementById('projectsBody');
            tbody.innerHTML = '';
            
            projects.forEach(project => {
                const row = document.createElement('tr');
                
                // 危险作业标签
                const dangerTags = project.dangerOperations?.map(op => 
                    `<span class="danger-tag">${op}</span>`
                ).join('') || '';
                
                row.innerHTML = `
                    <td>${project.id}</td>
                    <td>${project.tenantName}</td>
                    <td>${project.floor}-${project.unitNumber}</td>
                    <td>${project.decorationCompany}</td>
                    <td>${project.decorationType}</td>
                    <td>${project.decorationStartDate}</td>
                    <td>${project.decorationEndDate}</td>
                    <td><span class="status-badge status-${getStatusClass(project.status)}">${project.status}</span></td>
                    <td>${dangerTags}</td>
                    <td class="btn-group">
                        <button class="action-btn edit-btn" onclick="editProject('${project.id}')">编辑</button>
                        <button class="action-btn mark-btn" onclick="openMarkModal('${project.id}')">标记</button>
                        <button class="action-btn delete-btn" onclick="deleteProject('${project.id}')">删除</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // 加载危险作业
        function loadDangerOperations() {
            // 更新统计卡片
            const highWorkCount = projects.reduce((count, project) => 
                count + (project.dangerOperations?.includes('高空作业') ? 1 : 0), 0);
            const fireWorkCount = projects.reduce((count, project) => 
                count + (project.dangerOperations?.includes('动火作业') ? 1 : 0), 0);
            const limitedSpaceCount = projects.reduce((count, project) => 
                count + (project.dangerOperations?.includes('有限空间作业') ? 1 : 0), 0);
            const drainageCount = projects.reduce((count, project) => 
                count + (project.dangerOperations?.includes('泄水作业') ? 1 : 0), 0);
            
            document.getElementById('highWorkCount').textContent = highWorkCount;
            document.getElementById('fireWorkCount').textContent = fireWorkCount;
            document.getElementById('limitedSpaceCount').textContent = limitedSpaceCount;
            document.getElementById('drainageCount').textContent = drainageCount;
            
            // 加载危险作业表格
            const tbody = document.getElementById('dangerBody');
            tbody.innerHTML = '';
            
            projects.forEach(project => {
                if (project.dangerOperations && project.dangerOperations.length > 0) {
                    project.dangerOperations.forEach(dangerOp => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td><span class="danger-tag">${dangerOp}</span></td>
                            <td>${project.id}<br>${project.tenantName}</td>
                            <td>${project.floor}-${project.unitNumber}</td>
                            <td>${project.decorationStartDate} 至 ${project.decorationEndDate}</td>
                            <td>${project.projectManager || '未指定'}</td>
                            <td>${project.supervisor || '未指定'}</td>
                            <td><span class="status-badge status-${getStatusClass(project.status)}">${project.status}</span></td>
                            <td>
                                <button class="action-btn edit-btn" onclick="editProject('${project.id}')">详情</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                }
            });
        }
        
        // 加载巡检记录
        function loadInspectionRecords() {
            const tbody = document.getElementById('inspectionBody');
            tbody.innerHTML = '';
            
            inspectionRecords.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.date}</td>
                    <td>${record.projectId}</td>
                    <td>${record.inspector}</td>
                    <td>${record.problemType}</td>
                    <td>${record.description}</td>
                    <td><span class="status-badge ${record.severity === '高' ? 'status-delay' : 'status-approval'}">${record.severity}</span></td>
                    <td><span class="status-badge ${record.status === '已完成' ? 'status-completed' : 'status-delay'}">${record.status}</span></td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editInspection('${record.id}')">编辑</button>
                        <button class="action-btn delete-btn" onclick="deleteInspection('${record.id}')">删除</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // 初始化设置
        function initSettings() {
            loadDecorationTypes();
            loadDangerTypes();
        }
        
        // 加载装修类型
        function loadDecorationTypes() {
            const container = document.getElementById('decorationTypesList');
            container.innerHTML = '<div style="margin-bottom: 10px;">已配置的类型：</div>';
            
            decorationTypes.forEach((type, index) => {
                const item = document.createElement('div');
                item.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #eee;';
                item.innerHTML = `
                    <span>${type}</span>
                    <button class="action-btn delete-btn" onclick="removeDecorationType(${index})">删除</button>
                `;
                container.appendChild(item);
            });
        }
        
        // 加载危险作业类型
        function loadDangerTypes() {
            const container = document.getElementById('dangerTypesList');
            container.innerHTML = '';
            
            DANGER_TYPES.forEach(type => {
                const item = document.createElement('div');
                item.style.cssText = 'display: inline-block; margin: 5px; padding: 8px 12px; background-color: #f5f5f5; border-radius: 4px;';
                item.innerHTML = `
                    <span style="color: ${type.color}; font-weight: bold;">${type.name}</span>
                `;
                container.appendChild(item);
            });
        }
        
        // 页面切换
        function showPage(pageId) {
            // 隐藏所有页面
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            
            // 移除所有导航激活状态
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // 显示目标页面
            document.getElementById(pageId + '-page').style.display = 'block';
            
            // 激活对应导航
            event.target.classList.add('active');
            
            // 更新页面数据
            switch(pageId) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'projects':
                    loadProjectsTable();
                    break;
                case 'danger':
                    loadDangerOperations();
                    break;
                case 'inspection':
                    loadInspectionRecords();
                    break;
                case 'statistics':
                    updateStatistics();
                    break;
            }
        }
        
        // 打开新增项目模态框
        function openNewProjectModal() {
            // 生成项目ID
            const projectId = 'P' + new Date().getFullYear().toString().substr(2) + 
                           String(projects.length + 1).padStart(3, '0');
            document.getElementById('projectId').value = projectId;
            
            // 重置表单
            document.getElementById('projectForm').reset();
            
            // 设置默认日期
            const today = new Date();
            const endDate = new Date(today);
            endDate.setDate(today.getDate() + 30);
            
            document.getElementById('decorationStartDate').value = formatDate(today);
            document.getElementById('decorationEndDate').value = formatDate(endDate);
            
            openModal('newProjectModal');
        }
        
        // 保存项目
        function saveProject(event) {
            event.preventDefault();
            
            const project = {
                id: document.getElementById('projectId').value,
                tenantName: document.getElementById('tenantName').value,
                floor: document.getElementById('floor').value,
                unitNumber: document.getElementById('unitNumber').value,
                decorationCompany: document.getElementById('decorationCompany').value,
                decorationType: document.getElementById('decorationType').value,
                decorationStartDate: document.getElementById('decorationStartDate').value,
                decorationEndDate: document.getElementById('decorationEndDate').value,
                decorationArea: document.getElementById('decorationArea').value,
                projectManager: document.getElementById('projectManager').value,
                contactPhone: document.getElementById('contactPhone').value,
                dangerOperations: getSelectedDangerOperations(),
                remark: document.getElementById('projectRemark').value,
                status: '审批中',
                createdAt: new Date().toISOString()
            };
            
            projects.push(project);
            saveToLocalStorage();
            
            closeModal('newProjectModal');
            alert('项目保存成功！');
            
            // 刷新数据
            loadDashboardData();
            loadProjectsTable();
            loadDangerOperations();
        }
        
        // 获取选中的危险作业
        function getSelectedDangerOperations() {
            const selected = [];
            document.querySelectorAll('#dangerCheckboxes input[type="checkbox"]:checked').forEach(checkbox => {
                selected.push(checkbox.value);
            });
            return selected;
        }
        
        // 编辑项目
        function editProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            
            // 填充编辑表单（这里简化为使用新增表单）
            Object.keys(project).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = project[key];
                }
            });
            
            // 设置危险作业复选框
            document.querySelectorAll('#dangerCheckboxes input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = project.dangerOperations?.includes(checkbox.value) || false;
            });
            
            currentProjectId = projectId;
            openModal('newProjectModal');
        }
        
        // 删除项目
        function deleteProject(projectId) {
            if (confirm('确定要删除这个项目吗？')) {
                projects = projects.filter(p => p.id !== projectId);
                saveToLocalStorage();
                loadProjectsTable();
                loadDashboardData();
                alert('项目已删除！');
            }
        }
        
        // 打开标记模态框
        function openMarkModal(projectId) {
            currentProjectId = projectId;
            openModal('markModal');
        }
        
        // 保存标记
        function saveMark() {
            const markType = document.getElementById('markType').value;
            const description = document.getElementById('markDescription').value;
            
            // 创建巡检记录
            const inspectionRecord = {
                id: 'IN' + Date.now(),
                date: formatDate(new Date()),
                projectId: currentProjectId,
                inspector: '系统标记',
                problemType: getMarkTypeText(markType),
                description: description,
                severity: markType === 'danger' ? '高' : '中',
                status: '未处理',
                createdAt: new Date().toISOString()
            };
            
            inspectionRecords.push(inspectionRecord);
            saveToLocalStorage();
            
            closeModal('markModal');
            alert('标记已保存！');
            
            // 如果是危险标记，更新项目状态
            if (markType === 'danger') {
                const project = projects.find(p => p.id === currentProjectId);
                if (project) {
                    if (!project.dangerOperations) {
                        project.dangerOperations = [];
                    }
                    if (!project.dangerOperations.includes('其他危险作业')) {
                        project.dangerOperations.push('其他危险作业');
                    }
                    saveToLocalStorage();
                    loadDangerOperations();
                }
            }
            
            loadInspectionRecords();
            loadDashboardData();
        }
        
        // 获取标记类型文本
        function getMarkTypeText(type) {
            const types = {
                'warning': '问题预警',
                'danger': '危险作业',
                'delay': '进度延迟',
                'completed': '完工验收'
            };
            return types[type] || '其他';
        }
        
        // 添加装修类型
        function addDecorationType() {
            const newType = document.getElementById('newDecorationType').value.trim();
            if (!newType) {
                alert('请输入装修类型名称');
                return;
            }
            
            if (decorationTypes.includes(newType)) {
                alert('该装修类型已存在');
                return;
            }
            
            decorationTypes.push(newType);
            saveToLocalStorage();
            
            document.getElementById('newDecorationType').value = '';
            loadDecorationTypes();
            initDecorationTypeOptions();
            
            alert('装修类型添加成功！');
        }
        
        // 移除装修类型
        function removeDecorationType(index) {
            if (confirm('确定要删除这个装修类型吗？')) {
                decorationTypes.splice(index, 1);
                saveToLocalStorage();
                loadDecorationTypes();
                initDecorationTypeOptions();
            }
        }
        
        // 打开自定义类型模态框
        function openCustomTypeModal() {
            closeModal('newProjectModal');
            openModal('customTypeModal');
        }
        
        // 保存自定义类型
        function saveCustomType() {
            const typeName = document.getElementById('customTypeName').value.trim();
            if (!typeName) {
                alert('请输入类型名称');
                return;
            }
            
            if (!decorationTypes.includes(typeName)) {
                decorationTypes.push(typeName);
                saveToLocalStorage();
                
                // 更新选择框
                initDecorationTypeOptions();
                
                // 设置选中
                const select = document.getElementById('decorationType');
                select.value = typeName;
                
                alert('自定义类型添加成功！');
            } else {
                // 直接选中已存在的类型
                const select = document.getElementById('decorationType');
                select.value = typeName;
            }
            
            closeModal('customTypeModal');
            openModal('newProjectModal');
        }
        
        // 初始化楼层选项
        function initFloorOptions() {
            const floors = [];
            for (let i = 1; i <= 35; i++) {
                floors.push(i + 'F');
            }
            
            const selectElements = document.querySelectorAll('select[id="floor"], select[onchange*="filterByFloor"]');
            selectElements.forEach(select => {
                // 保存现有选项
                const existingOptions = select.querySelectorAll('option');
                const firstOption = existingOptions[0];
                
                // 清空并重新添加
                select.innerHTML = '';
                if (firstOption) select.appendChild(firstOption);
                
                floors.forEach(floor => {
                    const option = document.createElement('option');
                    option.value = floor;
                    option.textContent = floor;
                    select.appendChild(option);
                });
            });
        }
        
        // 初始化装修类型选项
        function initDecorationTypeOptions() {
            const select = document.getElementById('decorationType');
            select.innerHTML = '<option value="">请选择类型</option>';
            
            decorationTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                select.appendChild(option);
            });
            
            // 添加自定义选项
            const customOption = document.createElement('option');
            customOption.value = 'custom';
            customOption.textContent = '自定义类型...';
            select.appendChild(customOption);
            
            // 添加事件监听
            select.onchange = function() {
                if (this.value === 'custom') {
                    openCustomTypeModal();
                }
            };
        }
        
        // 初始化危险作业复选框
        function initDangerCheckboxes() {
            const container = document.getElementById('dangerCheckboxes');
            container.innerHTML = '';
            
            DANGER_TYPES.forEach(type => {
                const item = document.createElement('div');
                item.className = 'checkbox-item';
                item.innerHTML = `
                    <input type="checkbox" id="${type.id}" value="${type.name}">
                    <label for="${type.id}" style="color: ${type.color};">${type.name}</label>
                `;
                container.appendChild(item);
            });
        }
        
        // 格式化日期
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }
        
        // 获取状态类名
        function getStatusClass(status) {
            const map = {
                '审批中': 'approval',
                '施工中': 'construction',
                '待验收': 'construction',
                '已完工': 'completed',
                '已逾期': 'delay'
            };
            return map[status] || 'approval';
        }
        
        // 保存到本地存储
        function saveToLocalStorage() {
            localStorage.setItem('decorationProjects', JSON.stringify(projects));
            localStorage.setItem('inspectionRecords', JSON.stringify(inspectionRecords));
            localStorage.setItem('decorationTypes', JSON.stringify(decorationTypes));
            localStorage.setItem('dangerOperations', JSON.stringify(dangerOperations));
        }
        
        // 打开模态框
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }
        
        // 关闭模态框
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // 搜索项目
        function searchProjects(query) {
            // 简化的搜索功能
            console.log('搜索:', query);
        }
        
        // 筛选项目
        function filterByStatus(status) {
            console.log('按状态筛选:', status);
        }
        
        // 筛选楼层
        function filterByFloor(floor) {
            console.log('按楼层筛选:', floor);
        }
        
        // 搜索项目表格
        function searchProjectsTable(query) {
            console.log('表格搜索:', query);
        }
        
        // 打开新增巡检记录模态框
        function openNewInspectionModal() {
            // 这里可以添加打开巡检记录表单的逻辑
            alert('在实际应用中，这里会打开巡检记录表单');
        }
        
        // 更新统计
        function updateStatistics() {
            const container = document.getElementById('statisticsContent');
            
            // 生成统计HTML
            const html = `
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-label">项目总数</div>
                        <div class="stat-value">${projects.length}</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-label">审批中项目</div>
                        <div class="stat-value">${projects.filter(p => p.status === '审批中').length}</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-label">施工中项目</div>
                        <div class="stat-value">${projects.filter(p => p.status === '施工中').length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">平均工期(天)</div>
                        <div class="stat-value">30</div>
                    </div>
                </div>
                
                <h3 style="margin-top: 30px;">装修类型分布</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>装修类型</th>
                            <th>项目数量</th>
                            <th>占比</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${getDecorationTypeStats()}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = html;
        }
        
        // 获取装修类型统计
        function getDecorationTypeStats() {
            const stats = {};
            projects.forEach(project => {
                stats[project.decorationType] = (stats[project.decorationType] || 0) + 1;
            });
            
            let html = '';
            Object.entries(stats).forEach(([type, count]) => {
                const percentage = ((count / projects.length) * 100).toFixed(1);
                html += `
                    <tr>
                        <td>${type}</td>
                        <td>${count}</td>
                        <td>${percentage}%</td>
                    </tr>
                `;
            });
            
            return html;
        }
        
        // 处理预警
        function handleWarning(warningId) {
            const warning = inspectionRecords.find(r => r.id === warningId);
            if (warning) {
                warning.status = '处理中';
                saveToLocalStorage();
                loadDashboardData();
                loadInspectionRecords();
                alert('预警已标记为处理中');
            }
        }
        
        // 编辑巡检记录
        function editInspection(recordId) {
            // 这里可以添加编辑巡检记录的逻辑
            alert('编辑巡检记录功能');
        }
        
        // 删除巡检记录
        function deleteInspection(recordId) {
            if (confirm('确定要删除这条巡检记录吗？')) {
                inspectionRecords = inspectionRecords.filter(r => r.id !== recordId);
                saveToLocalStorage();
                loadInspectionRecords();
                loadDashboardData();
            }
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
